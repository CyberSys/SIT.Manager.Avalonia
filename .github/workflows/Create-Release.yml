name: Create Release

on:
  workflow_dispatch:

jobs:
  build:
    strategy:
      matrix:
        os: [ "win-x64", "linux-x64" ]

    runs-on: ubuntu-latest

    env:
      Solution_Name: SIT.Manager.sln

    steps:
    - name: Checkout
      uses: actions/checkout@v4
            
    - name: Setup .NET 8.0
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x

    - name: Get build date
      id: build
      shell: pwsh
      run: |
        $CurrentTime = Get-Date -Format 'yyMM'
        $BuildTime = Get-Date -Format 'ddHH'
        Write-Output "NOW=$CurrentTime" >> $env:GITHUB_OUTPUT
        Write-Output "VERSION=$BuildTime" >> $env:GITHUB_OUTPUT 
        
    - name: Build Published Version
      run: dotnet publish SIT.Manager.Desktop/SIT.Manager.Desktop.csproj -c Release -r ${{ matrix.os }} -p:BuildNumber=${{ steps.build.outputs.NOW }} -p:RevisionNumber=${{ steps.build.outputs.VERSION }}

    - name: Upload a Build Artifact  
      uses: actions/upload-artifact@v4.3.1
      with:
        name: ${{ matrix.os }}.zip
        path: ${{ github.workspace }}/SIT.Manager.Desktop/bin/Release/net8.0/${{ matrix.os }}/publish/*
        if-no-files-found: error

    # Create release as draft from the compressed file
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
          draft: true
          generate_release_notes: true
          files: ${{ matrix.os }}.zip
          tag_name: ManagerReleaseTest2